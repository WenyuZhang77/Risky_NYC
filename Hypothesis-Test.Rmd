---
title: 'Hypothesis Test'
author: "Fiona Li and Wenyu Zhang"
output: 
  html_document:
    toc: true
    toc_float: true
---
```{r, include=FALSE}
library(tidyverse)
library(rvest)
library(httr)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r, include=FALSE}
dat = read_csv("/Users/wenyuzhang/Desktop/final data/2020data.csv")
head(dat)
```

# Hypothesis Test

## Chi-squareed test to test homogeneity of race and level of offense

1. Import and Clean data

```{r}
dat_clean =
  dat %>%
  filter(!(susp_race == ""),
         !(susp_race == "UNKNOWN")) %>%
  mutate(level_of_offense = as.factor(level_of_offense)) %>%
  mutate(susp_race = as.factor(susp_race)) %>%
  group_by(susp_race,level_of_offense) %>%
  summarise(n_obs = n()) %>%
  pivot_wider(
  names_from = "susp_race", 
  values_from = "n_obs")
```

2. Do chi-squared test to test suspect gender and level of offense

```{r}
dat_clean1 =
  dat %>%
  filter(!(susp_sex == ""),
         !(susp_sex == "UNKNOWN"),
         !(susp_sex == "U")) %>%
  mutate(level_of_offense = as.factor(level_of_offense)) %>%
  mutate(susp_race = as.factor(susp_sex))

table(dat_clean1$level_of_offense, dat_clean1$susp_sex)
chisq.test(table(dat_clean1$level_of_offense, dat_clean1$susp_sex), correct = F)
```

3. Do chi-squared test to test suspect race and level of offense

```{r}
dat_clean2 =
  dat %>%
  filter(!(susp_race == ""),
         !(susp_race == "UNKNOWN")) %>%
  mutate(level_of_offense = as.factor(level_of_offense)) %>%
  mutate(susp_race = as.factor(susp_race))

table(dat_clean2$level_of_offense, dat_clean2$susp_race)
chisq.test(table(dat_clean2$level_of_offense, dat_clean2$susp_race), correct = F)
```

## ANOVA test

```{r}
wenyudata = 
  dat %>% 
  group_by(month, day, name_of_borough) %>% 
  select(completed_or_not, name_of_borough) %>% 
  filter(name_of_borough != "") %>% 
  summarise(count = n()) %>% 
  arrange(month,day) 

wenyudata
```

```{r}
wenyudata %>% 
  pivot_wider(names_from = name_of_borough,
              values_from = count) 
```

```{r}
wenyudata %>% 
  select(name_of_borough, count) %>% 
  group_by(name_of_borough) %>% 
  summarise(mean = mean(count),
            standard_error = sd(count)) %>% 
  knitr::kable(caption = "crime number in borough")
```

we want to do ANOVA test for different borough comparsion

$H_0$: there is no difference of crime number amount means between different boroughs
$H_1$: at least two crime number amount means of boroughs are not equal

```{r}
crime_total = 
  wenyudata %>% 
  select(name_of_borough, count) %>% 
  group_by(name_of_borough)
```

```{r}
aov_boro_number = 
  aov(count ~factor(name_of_borough), data = crime_total)

summary(aov_boro_number)
```

```{r}
Tukey_comp =
  TukeyHSD(aov_boro_number, conf.level = 0.99)

Tukey_comp $`factor(name_of_borough)` %>% 
  knitr::kable()
```
